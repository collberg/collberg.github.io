<!DOCTYPE html>
<html  >
<head>
  <!-- Site made with Mobirise Website Builder v4.10.10, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v4.10.10, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/tigress-white-128x101.png" type="image/x-icon">
  <meta name="description" content="Web Site Builder Description">
  
  <title>RandomFuns</title>
  <link rel="preload" as="style" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
<link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="preload" as="style" href="assets/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="preload" as="style" href="assets/bootstrap/css/bootstrap-grid.min.css">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="preload" as="style" href="assets/bootstrap/css/bootstrap-reboot.min.css">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/animatecss/animate.min.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
 
<style>
body {
  background-color: #ffffff;
  color: #000000
}
section {
  background-color: #ffffff;
  color: #000000
}
p {
   color: #767676
}
h3 {
   color: #767676
}
</style>

</head>
<body>

  <section class="menu cid-rCFaEeaKON" once="menu" id="menu1-v">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html">
                         <img src="assets/images/tigress-white-copy-154x122.png" alt="Mobirise" title="" style="height: 3.8rem;">
                    </a>
                </span>
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-4" href="index.html">
                        Tigress</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true"><li class="nav-item">
                    <a class="nav-link link text-white display-4" href="index.html">
                        
                        Home</a>
                </li><li class="nav-item">
                    <a class="nav-link link text-white display-4" href="introduction.html">
                        
                        Introduction</a>
                </li><li class="nav-item"><a class="nav-link link text-white display-4" href="usage.html">Usage</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="transformations.html">Transformations</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="publications.html">Publications</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="FAQ.html">FAQ</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="consulting.html">Consulting/Training</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="about.html">About</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="contact.html">Contact</a></li></ul>
            
        </div>
    </nav>
</section>

<br><br><br><br>

<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9618" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">One of the uses of Tigress is as an educational tool. The <code>--Transform=RandomFuns</code>
option will generate a random function that can subsequently be transformed using any
combination of Tigress obfuscations, and then given to students as a cracking target.</p></div></div></section>

<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9619" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">You can generate a program for the students to reverse engineer:</p></div></div></section>
   <center><img width="400px" src="tigress3-images/education-deobfuscate-3.png"></center>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9620" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">or you can generate a program for them to crack:</p></div></div></section>
   <center><img width="400px" src="tigress3-images/education-crack-3.png"></center>

<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9621" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">
Depending on the sophistication of your students, you can vary the length of the transformation
sequence, the difficulty of the transformations, the options to the transformations, 
the complexity of the generated challenge function, and either give them source to untangle
(a good way to learn about particular transformations), or stripped compiled code (for a more
real-world challenge).
</p></div></div></section>

<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9622" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">We typically give each student 3 programs, of different levels of difficulty,
to attack. Thanks to the diversity of Tigress-generated programs, each challenge
is unique, making it harder for students to cheat.</p></div></div></section> 

<a class="anchor" id="examples">&nbsp;</a>
<br>
<h3 align=center>Examples</h3>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9623" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">
Below is part of the script we use to generate take-home exams for our students.
It contains two <em>assets</em>, a password check and an expired time check, 
and it's the students' job to disable these.
</p></div></div></section>
Start by creating this file, <code>empty.c</code>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">#include "tigress.h"
#include<stdio.h>
#include<time.h>
#include<pthread.h>
</code></pre>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false"># Generate the cleartext challenge program. This is hidden from the students.
tigress --Verbosity=1 --Seed=$seed6 --Environment=x86_64:Darwin:Clang:5.1 \
      --Transform=RandomFuns \
         --RandomFunsName=SECRET \
         --Verbosity=5 \
         --RandomFunsFunctionCount=1 \
         --RandomFunsTrace=0 \
         --RandomFunsType=long \
         --RandomFunsInputSize=1 \
         --RandomFunsLocalStaticStateSize=1 \
         --RandomFunsGlobalStaticStateSize=0 \
         --RandomFunsLocalDynamicStateSize=0 \
         --RandomFunsGlobalDynamicStateSize=0 \
         --RandomFunsBoolSize=2 \
         --RandomFunsLoopSize=1000 \
         --RandomFunsCodeSize=100 \
         --RandomFunsOutputSize=1 \
         --RandomFunsTimeCheckCount=1 \
         --RandomFunsActivationCodeCheckCount=1 \
         --RandomFunsActivationCode=42 \
         --RandomFunsPasswordCheckCount=1 \
         --RandomFunsPassword=secret \
         --RandomFunsFailureKind=segv \
      --out=6-input.c empty.c

# Generate an empty program with the same interface as the challenge program
# for the students to fill out
tigress --Verbosity=1 --Seed=$seed6 \
      --Transform=RandomFuns --RandomFunsName=SECRET \
         --RandomFunsType=long \
         --RandomFunsInputSize=1 \
         --RandomFunsLocalStaticStateSize=1 \
         --RandomFunsGlobalStaticStateSize=0 \
         --RandomFunsLocalDynamicStateSize=0 \
         --RandomFunsGlobalDynamicStateSize=0 \
         --RandomFunsOutputSize=1 \
         --RandomFunsCodeSize=0 \
      --out=6-answer.c empty.c

# Obfuscate the challenge program. 
tigress --Verbosity=1 --Seed=$seed6 --FilePrefix=obf \
      --Transform=InitEntropy \
         --Functions=main\
      --Transform=InitOpaque \
         --Functions=main --InitOpaqueCount=1 --InitOpaqueStructs=list,array\
      --Transform=InitBranchFuns \
         --InitBranchFunsCount=2\
      --Transform=EncodeLiterals \
         --Functions=SECRET --EncodeLiteralsKinds=string --EncodeLiteralsEncoderName=STRINGS\
      --Transform=Virtualize \
         --Functions=STRINGS --VirtualizeDispatch=switch --VirtualizeOperands=stack,registers \
         --VirtualizeMaxMergeLength=2 --VirtualizeSuperOpsRatio=1.0 \
      --Transform=AddOpaque \
         --Functions=SECRET --AddOpaqueKinds=call,bug,true --AddOpaqueCount=4\
      --Transform=Virtualize \
         --Functions=SECRET --VirtualizeDispatch=indirect --VirtualizeOperands=stack,registers \
         --VirtualizeMaxMergeLength=2 --VirtualizeSuperOpsRatio=1.0 \
      --Transform=Virtualize \
         --Functions=SECRET --VirtualizeDispatch=ifnest --VirtualizeOperands=stack,registers \
         --VirtualizeMaxMergeLength=2 --VirtualizeSuperOpsRatio=1.0 --VirtualizeNumberOfBogusFuns=1\
      --Transform=EncodeLiterals \
         --Functions=SECRET --EncodeLiteralsKinds=integer \
       --Transform=BranchFuns \
         --Functions=SECRET --BranchFunsFlatten=true \
      --Transform=CleanUp \
         --CleanUpKinds=annotations,constants,names \
      --out=6-challenge.c 6-input.c
</code></pre>

<a class="anchor" id="structure">&nbsp;</a>
<br>
<h3 align=center>Structure of Random Programs</h3>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9624" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">To fulfill our needs, a random program generator must have certain characteristics:</p></div></div></section>
<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
   <li> in order to make it easy for reverse engineers to automate attacks, the 
        generated programs must a have simple I/O behavior;
   </li>
   <li> the generator must be able to produce an "infinite" sequence of different programs;
   </li>
   <li> generated programs should be small, but still have an "interesting" internal structure;
   </li>
   <li> generate programs should always terminate;
   </li>
   <li> generate programs should terminate <em>within a reasonable timebound</em>;
   </li>
   <li> an adversary should not be able to guess the internals of a generated
        program by examining its input-output behavior;
   </li>
   <li> generated programs should be "minimal," i.e. there should not be a smaller
        program that has the same I/O behavior (this is so that it is obvious to
        the reverse engineer when he has found the correct program).
   </li>
</ul>
</div></div></div></section>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9625" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">The generated challenge programs all take the following simple form:</p></div></div></section>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">#include &le;stdio.h&gt; 
#include &le;stdlib.h&gt;

void SECRET(unsigned long input[1] , unsigned long output[1] ) 
   ...
}
int main(int argc, char** argv) {
{ 
  unsigned long input[1] ;
  unsigned long output[1] ;
  int i5 ;
  unsigned long value6 ;
  int i7 ;
  }
  i5 = 0;
  while (i5 < 1) {
    value6 = strtoul(argv[i5 + 1], 0, 10);
    input[i5] = value6;
    i5 ++;
  }
  SECRET(input, output);
  i7 = 0;
  while (i7 < 1) {
    printf("%lu\n", output[i7]);
    i7 ++;
  }
} 
</code></pre>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9626" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">That is, a challenge program reads one or more longs from standard in, 
and produces one or more longs on standard out.</p></div></div></section>

<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9627" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">Internally, generated <code>SECRET</code> functions share the same basic structure:
an <em>expansion phase</em>, a <em>mixing phase</em>, and a <em>compression phase</em>:</p></div></div></section>
<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
  <li> The expansion phase expands the input arguments into a (typically larger) state space.
       It is currently a sequence of assignment statements.
   </li>
  <li> The mixing phase perform operations on the state space. This is where
       we add control structures.
   </li>
  <li> The Compression phase compresses the state into the (typically smaller) output.
       It is currently a sequence of assignment statements.
   </li>
</ul>
</div></div></div></section>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9628" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">Here is an example:</p></div></div></section>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">void SECRET(unsigned long input[1] , unsigned long output[1] ) { 
  unsigned long state[4] ;
  unsigned long local1 ;

  /* Expansion phase */
  state[0UL] = input[0UL] + 762537946UL;
  state[1UL] = input[0UL] | ((16601096UL << (state[0UL] % 16UL | 1UL)) | (16601096UL >> (64 - (state[0UL] % 16UL | 1UL))));
  state[2UL] = (input[0UL] ^ 643136481UL) ^ (state[0UL] + 292656718UL);
  state[3UL] = (input[0UL] << (((state[1UL] >> 4UL) & 15UL) | 1UL)) | (input[0UL] >> (64 - (((state[1UL] >> 4UL) & 15UL) | 1UL)));

  /* Mixing phase */
  local1 = 0UL;
  while (local1 < 3UL) {
    state[1UL] |= (state[2UL] & 15UL) << 3UL;
    state[local1 + 1UL] = state[local1];
    local1 += 2UL;
  }
  if ((state[0UL] | state[1UL]) > (state[2UL] | state[3UL])) {
    state[3UL] |= (state[1UL] & 31UL) << 3UL;
  } else {
    state[2UL] = state[0UL];
    state[3UL] |= (state[2UL] & 15UL) << 3UL;
  }
  state[0UL] = state[2UL];

  /* Compression phase */  
  output[0UL] = (state[0UL] << (state[1UL] % 8UL | 1UL)) << ((((state[2UL] << (state[3UL] % 8UL | 1UL)) >> 1UL) & 7UL) | 1UL);
}
</code></pre>

INSERT-OPTION options.in Transform:RandomFunsFunctionFunctionCount:RandomFunsTrace:RandomFunsInputSize:RandomFunsLocalStaticStateSize:RandomFunsLocalDynamicStateSize:RandomFunsGlobalStaticStateSize:RandomFunsGlobalDynamicStateSize:RandomFunsOutputSize:RandomFunsCodeSize:RandomFunsLoopSize:RandomFunsBoolSize:RandomFunsType:RandomFunsName:RandomFunsFailureKind:RandomFunsInputKind:RandomFunsDummyFailure:RandomFunsActivationCode:RandomFunsPassword:RandomFunsTimeCheckCount:RandomFunsActivationCodeCheckCount:RandomFunsPasswordCheckCount:RandomFunsControlStructures:RandomFunsBasicBlockSize:RandomFunsForBound:RandomFunsOperators:RandomFunsPointTest

<a class="anchor" id="issues">&nbsp;</a>
<br>
<h3 align=center>Issues</h3>
<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
   <li> Generating random functions is actually a really cool research problem! Generating a program that always
        terminates, finishes within a reasonable time, looks vaguely normal (i.e. could possibly have been
        written by a human), and has a unique and unpredicatable I/O behavior (i.e. the code can't be derived
        from blackbox access), is decidedly non-trival.
   </li>
   <li> A good solution to this problem should be worthy of at least a master's thesis, for sure! 
        Email me! <code>(:</code>
   </li>
   <li> This implementation doesn't achieve any of the stated goals. In particular, it's hard to ensure that 
        all programs generated from the same script runs in a reasonable time. 
   </li>
   <li> Various options can be used to tweak the runtime, in particular <code>--RandomFunsLoopSize=1000</code>
        which bounds the number of loop iterations.
   </li>
   <li> If you're willing to set the control structures yourself using 
        <code>--RandomFunsControlStructures="(if (bb 5) (bb 2))"</code>, then the problem goes away.
        When these are generated automatically, however, there's always some risk that you'll
        wind up with <code>--RandomFunsControlStructures="(for (for (for (for (bb 4)))))"</code> which is
        likely to run forever. I try to mitigate this by reducing the
        loop size (set by <code>--RandomFunsLoopSize=1000</code>) by a factor of 10 for every 
        nesting level, but this doesn't help if looping is interprocedural (I don't currently
        check for this).
   </li>
   <li> The random call graphs are actually just trees. They should be DAGs, at least.
   </li>
</ul>
</div></div></div></section>

<a class="anchor" id="references">&nbsp;</a>
<br>
<h3 align=center>References</h3>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c9629" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">Random function generation is described in 
<a href="https://www.usenix.org/conference/usenixsecurity17/technical-sessions/presentation/banescu">
   Predicting the Resilience of Obfuscated Code Against Symbolic Execution Attacks via Machine Learning
</a> by Sebastian Banescu, Christian Collberg, and Alexander Pretschner, USENIX Security 2017.
</p></div></div></section>

  <script src="assets/popper/popper.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script async src="assets/tether/tether.min.js"></script>
  <script async src="assets/dropdown/js/nav-dropdown.js"></script>
  <script async src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script async src="assets/touchswipe/jquery.touch-swipe.min.js"></script>
  <script async src="assets/viewportchecker/jquery.viewportchecker.js"></script>
  <script async src="assets/smoothscroll/smooth-scroll.js"></script>
  <script async src="assets/theme/js/script.js"></script>
  
  
  <input name="animation" type="hidden">
  
</body>
</html>
