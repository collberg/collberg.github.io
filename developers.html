<!DOCTYPE html>
<html  >
<head>
  
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/tigress-white-128x101.png" type="image/x-icon">
  <meta name="description" content="Web Page Generator Description">
  
  
  <title>Developers</title>
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/popup-overlay-plugin/style.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600,700,800,900,300i,400i,500i,600i,700i,800i,900i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600,700,800,900,300i,400i,500i,600i,700i,800i,900i&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">

  
  
  
</head>
<body>
  
  <section class="menu cid-um6XCocMlb" once="menu" id="menu1-8b">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html">
                         <img src="assets/images/screenshot-2024-08-20-at-14.25.07-copy-126x121.png" alt="" title="" style="height: 4.1rem;">
                    </a>
                </span>
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-4" href="index.html">
                        Tigress</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true"><li class="nav-item">
                    <a class="nav-link link text-white display-4" href="index.html">
                        
                        Home</a>
                </li><li class="nav-item dropdown">
                    <a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Usage</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="quickstart.html">Quickstart<br></a><a class="text-white dropdown-item text-primary display-4" href="mergeFiles.html">File merge<br></a><a class="text-white dropdown-item text-primary display-4" href="crossCompile.html">Cross compile</a><a class="text-white dropdown-item text-primary display-4" href="recipes.html">Recipes</a><a class="text-white dropdown-item text-primary display-4" href="recipies.html">Libraries</a><a class="text-white dropdown-item text-primary display-4" href="top-level.html">Top-Level Options</a><a class="text-white dropdown-item text-primary display-4" href="bugs.html">Issues</a><a class="text-white dropdown-item text-primary display-4" href="tigress-test.html">Testing</a></div>
                </li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Platforms</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="linux.html">Linux<br></a><a class="text-white dropdown-item text-primary display-4" href="macos.html">MaxOS<br></a><a class="text-white dropdown-item text-primary display-4" href="windows.html">Windows<br></a><a class="text-white dropdown-item text-primary display-4" href="android.html">Android<br></a><a class="text-white dropdown-item text-primary display-4" href="wasm.html">WASM<br></a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Users</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="academics.html">For academics<br></a><a class="text-white dropdown-item text-primary display-4" href="students.html">For students<br></a><a class="text-white dropdown-item text-primary display-4" href="practitioners.html">For practitioners<br></a><a class="text-white dropdown-item text-primary display-4" href="developers.html">For developers<br></a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Transformations</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="control.html">Control</a><a class="text-white dropdown-item text-primary display-4" href="data.html">Data</a><a class="text-white dropdown-item text-primary display-4" href="functions.html">Functions</a><a class="text-white dropdown-item text-primary display-4" href="integrity.html">Integrity</a><a class="text-white dropdown-item text-primary display-4" href="environment.html">Environment</a><a class="text-white dropdown-item text-primary display-4" href="antiAnalysis.html">Anti analysis</a><a class="text-white dropdown-item text-primary display-4" href="other.html">Other</a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Info</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="news.html">News<br></a><a class="text-white dropdown-item text-primary display-4" href="blog.html">Blog<br></a><a class="text-white dropdown-item text-primary display-4" href="FAQ.html">FAQ</a><a class="text-white dropdown-item text-primary display-4" href="publications.html">Pubs<br></a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">About</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="about.html">History<br></a><a class="text-white dropdown-item text-primary display-4" href="consulting.html">Training<br></a><a class="text-white dropdown-item text-primary display-4" href="contact.html">Contact</a></div></li><li class="nav-item"><a class="nav-link link text-white text-primary display-4" href="download4.html" aria-expanded="false">Download</a></li></ul>
            
        </div>
    </nav>
</section>



<section class="header9 cid-um6XCmCNeD" id="header9-82">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">Here is an example of how to transform a function bar in a program foo.c using Tigress. The first transformation flattens the code, the second turns the flattened function into an interpreter:</p>
            
        </div>
    </div>

    
</section>

<section class="mbr-section content4 cid-um6Ybp9MBu" id="content4-8c">

    

    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
                    For Developers</h2>
                
                
            </div>
        </div>
    </div>
</section>

<section class="header9 cid-um6XCmRQfb" id="header9-84">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7"><strong>T</strong>igress is built in OCaml (about 100,000 lines of code) and C (about 9000 lines) on top of two libraries: <a href="http://cil-project.github.io/cil/doc/html/cil/" target="_blank">CIL</a>&nbsp;(a C front end) and <a href="http://myjit.sourceforge.net" target="_blank">MyJit</a>&nbsp;(a run-time code generator). For those who want to do Tigress development, or are merely curious of what an obfuscator looks like, I'm going to give a quick overview of the system. Here's an excerpt of the Tigress source file-tree:<br></p>
            
        </div>
    </div>

    
</section>



<section class="cid-umdVHEQwf2" id="image2-af">

    

    <figure class="mbr-figure container">
        <div class="image-block" style="width: 47%;">
            <img src="assets/images/tigress-filetree-1-687x995.png" alt="" title="">
            
        </div>
    </figure>
</section>

<section class="header9 cid-um6XCn2Kh4" id="header9-85">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7"><br>The main directory is <strong>obf, </strong>which has a sub-directory for every transformation.&nbsp; The <strong>obf/utils</strong> directory contains libraries used by one or more transformations.&nbsp;<br></p>
            
        </div>
    </div>

    
</section>





<section class="mbr-section content4 cid-umdXZ7QIwq" id="content4-ag">

    

    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">The EncodeData Transformation</h2>
                
                
            </div>
        </div>
    </div>
</section>

<section class="header9 cid-umgCfykVbA" id="header9-aj">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">As an example, let's consider the <strong>EncodeData</strong> transformation. The infrastructure code that supports this transformation&nbsp; is in the directory&nbsp;<strong>obf/encodeData</strong>. This code is responsible for taking the input from the user (for this transformation a list of variables to be encoded),&nbsp; deciding which variables have to be encoded (the user may have asked for <strong>x</strong> to be encoded, but because of pointers, we may have to encode additional variables), selecting the encoding module to use, and performing the actual code transformation (such as <strong>x+y </strong>being transformed into<strong> 42^((x^42)+(y^42)) </strong>if <strong>x</strong> and y<strong> </strong>are encoded with the <strong>ValueCodecXor</strong> module).&nbsp;<br><br>Every transformation has to implement an interface like the one below. There are a few different variants, depending on what should be transformed. <strong>EncodeData</strong> transforms variables, so it implements the <strong>transformVariables</strong> interface:</p>
            
        </div>
    </div>

    
</section>

<div id="custom-html-al"><center>
<div style="width:1000px;overflow:auto">
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable="" spellcheck="false">class virtual transformVariables :
  Universe.t -&gt;
  Transform.transformationKind -&gt;
  Options.t -&gt;
  object
    (* Check that this transformation was called properly. *)
    method functionMustNotHaveBeenPreviouslyTransformedBy :
       (transformationKind * string) list
    method mustHaveBeenPrecededByTransformations          : 
       (transformationKind * string) list
    method noTransformationMayFollowThisOne : string option
    method notSupportedOnThesePlatforms : platform list

    method deprecated : string option

    (* Check for reasons this transformation can't be applied. *)
    method checkTransformable : unit

    (* Get variables/functions/etc that need to be transformed. *)
    method private allFunctions :  
       Cil.fundec list
    method private allReferencedFunctions :  
       Cil.fundec list
    method private getCallers :  
       Cil.fundec list
    method private globalTargets :  
       (string * string option) list
    method private localTargets :  
       (Cil.fundec * string * string option) list
    method private pseudoReturnTargets :  
       (string * string * string option) list
    method private targetNames :  
       string list
    method private targets :  
       Cil.fundec list

    (* Perform the transformation. *)
    method virtual transform : unit
end
</code></pre>
</div>
</center>
</div>

<section class="cid-ume8X0JIPB" id="image2-ah">

    

    <figure class="mbr-figure container">
        <div class="image-block" style="width: 65%;">
            <img src="assets/images/encodedata-filetree-784x455.png" alt="" title="">
            
        </div>
    </figure>
</section>

<section class="header9 cid-umgEdZzwWL" id="header9-ak">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">The directory <strong>obf/utils/valueCodecs</strong> holds the actual encoders. As you see, there are a number of them, since they are separated from the infrastructure component, it is easy to add new and interesting encoders. Every encoder simply has to implement the interface below, with functions that encode and decode and perform arithmetic. Note that the encode function takes an expression as input, and produced a list of expressions as output. This is to support encoders that <strong>Residue Value Numbering</strong> that splits one value into multiple values. For the same reason, binary arithmetic operates on lists of expressions:</p>
            
        </div>
    </div>

    
</section>

<div id="custom-html-ai"><center>
<div style="width:1000px;overflow:auto">
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable="" spellcheck="false">class virtual transformer = object (self)
   method virtual newTypes : 
      typ list

   method virtual encode   : 
      fundec -&gt; exp -&gt; exp list  * stmt list
   method virtual decode   : 
      fundec -&gt; exp list-&gt; exp  * stmt list

   method virtual unaryOp  : 
      fundec -&gt; unop -&gt; exp list -&gt; exp list  * stmt list
   method virtual binaryOp : 
      fundec -&gt; binop -&gt; exp list -&gt; exp list -&gt; exp list  * stmt list
   method virtual question : 
      fundec -&gt; exp -&gt; exp list -&gt; exp list -&gt; exp list * stmt list
end
</code></pre>
</div>
</center>
</div>

<section class="header9 cid-umgJElfUw6" id="header9-am">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">Most of Tigress' transformations are designed in this way: there is an infrastructure component that is in charge of performing the actual transformation, and a set of "library" units which are separate from the infrastructure, and which can easily be expanded on; opaque predicates work this way, implicit flow works this way, and so on.</p>
            
        </div>
    </div>

    
</section>

<section class="mbr-section content4 cid-umgN6N5xAP" id="content4-ao">

    

    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
                    Debugging</h2>
                
                
            </div>
        </div>
    </div>
</section>

<section class="header9 cid-umgNbui1ji" id="header9-ap">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">Debugging a diversifying obfuscator is insanely difficult. There are many sources of complexity:</p>
            
        </div>
    </div>

    
</section>

<section class="mbr-section article content12 cid-umgNLA7Sfp" id="content12-aq">
     

    <div class="container">
        <div class="media-container-row">
            <div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
                <ul>
                    <li>For every transformation you add, the generated code gets longer, and more complex. Some issues will only appear only after several levels of transformation when the code - by definition! - is impenetrable.</li></ul><ul>
                    <li><span style="font-size: 1rem;">Every time Tigress can make a decision, it rolls a die and picks one of the possible options randomly. In fact, there are 333 locations in the Tigress source code that make a random selection!&nbsp; You can use the '<strong>--Seed=</strong>' options to initialize the random number generator and thereby generate multiple differently obfuscated versions of the same code. However, this nondeterminancy makes debugging extremely difficult: a particular issue may only show itself for a very specific combination of input program, transformation sequence, and seed.</span></li><li><span style="font-size: 1rem;">The output of&nbsp; Tigress will, of course, be compiled. And the compiler - which was tested mostly on code written by humans - may never have seen the type of convoluted code that Tigress produces! And this can trigger bugs in the compiler.</span></li><li><span style="font-size: 1rem;">Every compiler is different, and we try to support as many platforms as possible.&nbsp;</span></li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section class="header9 cid-umgRhYYtbW" id="header9-ar">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">The list goes on. To make debugging relatively sane, we make extensive use of logging. You can turn it on like this:</p>
            
        </div>
    </div>

    
</section>

<div id="custom-html-an"><!-- Type valid HTML here -->
<center>
    <div style="width:800px;overflow:auto">
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black"><code>tigress --Verbosity=3 --LogDir=log --GraphvizBuild=pdf ...
</code></pre>
    </div>
</center></div>

<section class="header9 cid-umgRIVxBnh" id="header9-at">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">Let's look at an example, again using the <strong>EncodeData</strong> transformation. Here is the input program, <strong>encode3.c</strong>:<br></p>
            
        </div>
    </div>

    
</section>

<div id="custom-html-as"><!-- Type valid HTML here -->
<center>
    <div style="width:800px;overflow:auto">
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black"><code>void ENCODE() {
  int x = 41;
  int* z = &amp;x;
  int** w = &amp;z;
  **w += 1;

  printf("RESULT=%i\n",x);
}

int main() {
  ENCODE();
  return 0;
}

</code></pre>
    </div>
</center></div>

<section class="header9 cid-umgSQleJmm" id="header9-av">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">And here is the Tigress transformation script:</p>
            
        </div>
    </div>

    
</section>

<div id="custom-html-au"><!-- Type valid HTML here -->
<center>
    <div style="width:800px;overflow:auto">
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black"><code>&gt; tigress \
   --LogDir=log --Verbosity=3  --GraphvizBuild=pdf \
   --Environment=x86_64:Darwin:Clang:12.0  --Seed=0 \
   --Transform=InitEntropy \
   --Transform=EncodeData \
      --EncodeDataDebug=traceUpdates \
      --EncodeDataCodecs=poly1 \
      --LocalVariables='ENCODE:x' \
   encode3.c --out=encode3_poly1_obf.c
</code></pre>
    </div>
</center></div>

<section class="header9 cid-umgT50DHhr" id="header9-aw">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">Notice that we've turned on logging and added additional EncodeData tracing, to help with debugging. Here's a small piece of the tracing output:</p>
            
        </div>
    </div>

    
</section>

<div id="custom-html-ax"><!-- Type valid HTML here -->
<center>
    <div style="width:1000px;overflow:auto">
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black"><code>BEGIN TRANSFORM ()
      STEP Alias graph after connected components have been computed:
        'log/aliasGraphWithComponents_17.pdf
      STEP Connected components computed from alias graph: 
         {0: [ENCODE:z/2987,ENCODE:x/2986, ENCODE:w/2988]}
   TASK Compute affected variables.
      STEP After computing affected function pointers: 
           target variables=[ENCODE:x/2986];
           reachable variables=[]; 
           encoded variables=[ENCODE:x/2986]; 
           points to encoded variables= [ENCODE:
           z/2987]; signature changed functions= []; 
           implementation changed functions= [ENCODE/2985];
           init changed functions= []; 
           pseudo return variables=[]; 
           components= {0: [ENCODE:z/2987,ENCODE:x/2986,ENCODE:w/2988]};
   TASK Select data transformation for affected variables.
      STEP Variables mapped to their encoder: 
           [ENCODE:x/2986-&gt;poly1:f(x:int)=1682595229*x+1015937501]
   TASK Transform affected variables.
      STEP Updating functions whose implementation has changed: 
          [ENCODE/2985]
      STEP Function 'ENCODE' before variable transformations:
          'ENCODE/2985' saved to log/ENCODE_25.pdf
      STEP Function 'ENCODE' after variable transformations:
          'ENCODE/2985' saved to log/ENCODE_27.pdf
END TRANSFORM ()

</code></pre>
    </div>
</center></div>

<section class="mbr-section content6 cid-umgWpgxjbR" id="content6-b4">
    
     
    
    <div class="container">
        <div class="media-container-row">
            <div class="col-12 col-md-8">
                <div class="media-container-row">
                    <div class="mbr-figure" style="width: 25%;">
                      <img src="assets/images/aliasgraphwithcomponents-17-116x329.png" alt="">  
                    </div>
                    <div class="media-content">
                        <div class="mbr-section-text">
                            <p class="mbr-text mb-0 mbr-fonts-style display-7">Here is the very simple alias graph that gets computed from the input program.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="header9 cid-umgVSYhcpM" id="header9-b1">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">Here is the Abstract Syntax Tree for the input program that got produced as part of the tracing:</p>
            
        </div>
    </div>

    
</section>

<section class="cid-umgVfB08jk" id="image2-az">

    

    <figure class="mbr-figure container">
        <div class="image-block" style="width: 90%;">
            <img src="assets/images/encode-25-1443x930.png" alt="" title="">
            
        </div>
    </figure>
</section>

<section class="header9 cid-umgVTFxIZX" id="header9-b2">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">And the corresponding AST after the <strong>EncodeData</strong> transformation:<br></p>
            
        </div>
    </div>

    
</section>

<section class="cid-umgV8fnfXD" id="image2-ay">

    

    <figure class="mbr-figure container">
        <div class="image-block" style="width: 95%;">
            <img src="assets/images/encode-27-1443x907.png" alt="" title="">
            
        </div>
    </figure>
</section>

<section class="header9 cid-umgXNx2ge4" id="header9-b5">

    

    

    <div class="container">
        <div class="media-container-column mbr-white">
            
            
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">When logging is turned on, we dump the internal data structures (AST, CFG, alias graph, etc.) after each operation. When a bug is discovered, it is sometimes possible to quickly track it down by comparing subsequent data structures. If you're curious about how Tigress works internally, watching the transformation logging information can be also be very interesting.&nbsp;</p>
            
        </div>
    </div>

    
</section>


<script src="assets/popper/popper.min.js"></script>
  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/smoothscroll/smooth-scroll.js"></script>
  <script src="assets/dropdown/js/nav-dropdown.js"></script>
  <script src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="assets/touchswipe/jquery.touch-swipe.min.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  
  
</body>
</html>