<!DOCTYPE html>
<html  >
<head>
  <!-- Site made with Mobirise Website Builder v4.10.10, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v4.10.10, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/tigress-white-128x101.png" type="image/x-icon">
  <meta name="description" content="Web Site Builder Description">
  
  <title>AddOpaque</title>
  <link rel="preload" as="style" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
<link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="preload" as="style" href="assets/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="preload" as="style" href="assets/bootstrap/css/bootstrap-grid.min.css">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="preload" as="style" href="assets/bootstrap/css/bootstrap-reboot.min.css">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/animatecss/animate.min.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
 
<style>
body {
  background-color: #ffffff;
  color: #000000
}
section {
  background-color: #ffffff;
  color: #000000
}
p {
   color: #767676
}
h3 {
   color: #767676
}
</style>

</head>
<body>

  <section class="menu cid-rCFaEeaKON" once="menu" id="menu1-v">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html">
                         <img src="assets/images/tigress-white-copy-154x122.png" alt="Mobirise" title="" style="height: 3.8rem;">
                    </a>
                </span>
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-4" href="index.html">
                        Tigress</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true"><li class="nav-item">
                    <a class="nav-link link text-white display-4" href="index.html">
                        
                        Home</a>
                </li><li class="nav-item">
                    <a class="nav-link link text-white display-4" href="introduction.html">
                        
                        Introduction</a>
</li><li class="nav-item"><a class="nav-link link text-white display-4" href="usage.html">Usage</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="transformations.html">Transformations</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="recipes.html">Recipes</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="publications.html">Publications</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="blog.html">Blog</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="FAQ.html">FAQ</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="consulting.html">Training</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="about.html">About</a></li><li class="nav-item"><a class="nav-link link text-white display-4" href="contact.html">Contact</a></li></ul>
            
        </div>
    </nav>
</section>

<br><br><br><br>
<center><h1>Add Opaque</h1></center>

<center><img width="500px" src="tigress3-images/addOpaque-front-page.png"></center>

<a class="anchor" id="addOpaque">&nbsp;</a>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2072" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">Break up code blocks by inserting opaque predicates. Requires that 
at least the <a href="opaque.html">InitOpaque</a>
transform has been previously issued and, preferably, that one or more 
 <a href="opaque.html">UpdateOpaque</a>
transformations have been given.</p></div></div></section>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--Transform</tt></td>
<td><tt>AddOpaque</tt></td>
<td> Add opaque predicates to split up control-flow. </td>
</tr>
<tr>
<td><tt>--AddOpaqueCount</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> How many opaques to add to each function. Default=1.</td>
</tr>
<tr>
<td><tt>--AddOpaqueKinds</tt></td>
<td><tt>call, bug, true, junk, fake, question, *</tt></td>
<td> Comma-separated list of the types of insertions of bogus computation allowed. Default=<tt>call,bug,true,junk,question</tt>.
<ul>
   <li> <tt>call</tt> = <tt>if (false) RandomFunction()</tt>
   <li> <tt>bug</tt> = <tt>if (false) BuggyStatement else RealStatement</tt>
   <li> <tt>true</tt> = <tt>if (true) RealStatement</tt>
   <li> <tt>junk</tt> = <tt>if (false) asm(".byte random bytes")</tt>
   <li> <tt>fake</tt> = <tt>if (False) NonExistingFunction()</tt>
   <li> <tt>question</tt> = <tt>if (True || False) RealStatement else CopyOfRealStatement</tt>
   <li> <tt>*</tt> = Turns all options on.
</ul>
</td>
</tr>
<tr>
<td><tt>--AddOpaqueObfuscate</tt></td>
<td><tt><em>BOOL</em></tt></td>
<td> Perform some light obfuscation of copied code when using the 'question' opaque predicate. Default=true.</td>
</tr>
<tr>
<td><tt>--AddOpaqueInline</tt></td>
<td><tt><em>BOOL</em></tt></td>
<td> Inline the split out functions when using 'question' opaque predicates. Default=false.</td>
</tr>
<tr>
<td><tt>--AddOpaqueSplitKinds</tt></td>
<td><tt>top, block, deep, recursive, level, inside</tt></td>
<td> Comma-separated list specifying the order in which different split methods are attempted when <tt>--AddOpaqueKinds=question</tt> is specified. Default=top,block,deep,recursive.
<ul>
   <li> <tt>top</tt> = split the top-level list of statements into two functions <tt>funcname_split_1</tt> and <tt>funcname_split_2</tt>.
   <li> <tt>block</tt> = split a basic block (list of assignment and call statements) into two functions.
   <li> <tt>deep</tt> = split out a nested control structure of at least height>2 into its own function <tt>funcname_split_1</tt>.
   <li> <tt>recursive</tt> = same as block, but calls to split functions are also allowed to be split out.
   <li> <tt>level</tt> = split out a statement at a level specified by <tt>--AddOpaqueSplitLevel</tt>.
   <li> <tt>inside</tt> = split out a statement at the innermost nesting level.
</ul>
</td>
</tr>
<tr>
<td><tt>--AddOpaqueSplitLevel</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Levels which could be split out when specifying <tt>--AddOpaqueSplitKinds=level</tt> Default=1.</td>
</tr>
<tr>
<td><tt>--AddOpaqueStructs</tt></td>
<td><tt>list, array, input, env, *</tt></td>
<td> Default=list,array.
<ul>
   <li> <tt>list</tt> = Generate opaque expressions using linked lists
   <li> <tt>array</tt> = Generate opaque expressions using arrays
   <li> <tt>input</tt> = Generate opaque expressions that depend on input. Requires <tt>--Inputs</tt> to set invariants over input.
   <li> <tt>env</tt> = Generate opaque expressions from entropy. Requires <tt>--InitEntropy</tt>.
   <li> <tt>*</tt> = Same as list,array,input,env
</ul>
</td>
</tr>
</table>
</div>

</center>
</br>

<a class="anchor" id="diversity">&nbsp;</a>
<br>
<h3 align=center>Diversity</h3>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2073" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">There are two sources of diversity:</p></div></div></section>
<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
  <li>The types of opaque predicates used, which is controlled by the InitOpaque
      transformation.
   </li>
  <li>The location in the target function where the split takes places, which is
      randomized.
   </li>
</ul>
</div></div></div></section>

<a class="anchor" id="usage">&nbsp;</a>
<br>
<h3 align=center>Usage</h3>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2074" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">This is the code generated for the arguments options to <code>--AddOpaqueKinds</code>:</p></div></div></section>

<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
   <li> <code>call</code>:
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if expr<sup>=false</sup> then
   call to random existing function
</code></pre>
</center>
    </li>

   <li><code>fake</code>:
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if expr<sup>=false</sup> then
   call to non-existing function
</code></pre>
</center>
    </li>

   <li> <code>true</code>:
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if expr<sup>=true</sup> then
   existing statement
</code></pre>
</center>
    </li>

    <li><code>bug</code>:
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if expr<sup>=true</sup> then
   existing statement
else
   buggified version of the statement
</code></pre>
</center>
    </li>

   <li><code>question</code>:
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if expr<sup>=true || false</sup> then
   existing statement
else
   obfuscated version of the statement
</code></pre>
</center>
    </li>

   <li><code>junk</code>:
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if expr<sup>=false</sup> then
   asm(".byte RandomBytes")
</code></pre>
</center>
    </li>

</ul>
</div></div></div></section>


<a class="anchor" id="QuestionMark">&nbsp;</a>
<br>
<h3 align=center>Question-mark Predicates</h3>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2075" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">Consider the following script:</p></div></div></section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">tigress --Seed=0 \
   --Inputs="+1:int:42,-1:length:1?10" \
   --Transform=InitImplicitFlow \
   --Transform=InitEntropy \
   --Transform=InitOpaque \
      --Functions=main \
      --InitOpaqueCount=2 \
      --InitOpaqueStructs=list,array,input,env \
   --Transform=AddOpaque \
      --Functions=obf3 \
      --AddOpaqueKinds=question \
      --AddOpaqueSplitKinds=inside \
      --AddOpaqueCount=10 \
   arith.c --out=arith_out.c
</code></pre>
</center>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2076" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">The result will look something like this:</p></div></div></section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">     {
      strcmp_result5 = (int )strlen(*(_4_main__argv + (_4_main__argc - 1)));
      }
      if (x >= strcmp_result5 + y) {
        {

        }
        if (_2entropy * 3 >= _4_main__opaque_list1_1->data) {
          {
          atoi_result10 = atoi(*(_4_main__argv + 1));
          }
          if (y >= atoi_result10 + x) {
            {

            }
            if (_4_main__opaque_array_0[(atoi_result10 & 2147483647) % 30] >= 22) {
              {

              }
              if (_4_main__opaque_list2_2->data <= (_2entropy | 6) + (_2entropy & 6)) {
                {
                strcmp_result15 = (int )strlen(*(_4_main__argv + (_4_main__argc - 1)));
                }
                if (x >= strcmp_result15 + y) {
                  {
                  atoi_result17 = atoi(*(_4_main__argv + 1));
                  }
                  if (y >= atoi_result17 + y) {
                    {
                    atoi_result19 = atoi(*(_4_main__argv + 1));
                    }
                    if (y >= atoi_result19 + y) {
                      {
                      strcmp_result21 = (int )strlen(*(_4_main__argv + (_4_main__argc - 1)));
                      }
                      if (y >= strcmp_result21 + atoi_result10) {
                        {

                        strcmp_result23 = (int )strlen(*(_4_main__argv + (_4_main__argc - 1)));
                        if (y <= strcmp_result23 + x) {
                          QUESTION_10_1(& z);
                        } else {
                          QUESTION_10_1_COPY(atoi_result24, & z);
                        }

                        }
                      } else {
                        {
                        QUESTION_9_1_COPY(& z, 6.);
                        }
                      }
                      {

                      }
                    } else {
                      {
                      QUESTION_8_1_COPY(& z, 1L);
                      }
                    }
                    {

                    }
                  } else {
                    {
                    QUESTION_7_1_COPY(& z, z);
                    }
                  }
                  {

                  }
                } else {
                  {
                  QUESTION_6_1_COPY(0, & z);
                  }
                }
                {

                }
              } else {
                {
                QUESTION_5_1_COPY(& z, 0);
                }
              }
              {

              }
            } else {
              {
              QUESTION_4_1_COPY(0, & z);
              }
            }
            {

            }
          } else {
            {
            QUESTION_3_1_COPY(& z, 0.);
            }
          }
          {

          }
        } else {
          {
          QUESTION_2_1_COPY(4L, & z);
          }
        }
        {

        }
      } else {
        {
        QUESTION_1_1_COPY(6L, & z);
        }
      }
      {

      }
    }
}
</code></pre>
</center>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2077" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">Notice that we attempt (and sometimes fail) to select opaque predicates 
<code>expr<sup>1</sup><=expr<sup>2</sup></code> such that</p></div></div></section>
<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
   <li> all the <code>expr<sup>i</sup></code> are independent of each other (i.e. 
        analyzing a function should require you to break all the predicates
        in it); 
   </li>
   <li> the <code>expr<sup>i</sup></code> depend on input (either because they 
        are created from an entropy source or from invariants over the command 
        line arguments); and 
   </li>
   <li> <code>expr<sup>1</sup></code> and <code>expr<sup>2</sup></code> are computed
        from different sources.
   </li>
</ul>
</div></div></div></section>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2078" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">For the question-mark predicate we use the function splitter. You should
experiment with different splitting methods to get the effect that you 
want, by setting <code>--AddOpaqueSplitKinds=...</code> and 
<code>--AddOpaqueSplitLevel=...</code>. <code>--AddOpaqueObfuscate=true</code> does
some light obfuscation to the code in one of the branches; you can, of course,
obfuscate the split out functions yourself.</p></div></div></section>

<a class="anchor" id="issues">&nbsp;</a>
<br>
<h3 align=center>Issues</h3>
<section class="mbr-section article content12 cid-rDNq15ll1q" id="content12-d"><div class="container"><div class="media-container-row"><div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
<ul>
<li><section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2079" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff"><code>--AddOpaqueKinds=fake</code> will result in undefined symbols being generated. You need to
coerce the linker to ignore such errors. With <code>gcc</code> you can use this option:</p></div></div></section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">   -Wl,--unresolved-symbols=ignore-in-object-files 
</code></pre>
</center>
<section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2080" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">No similar option seems to exist for <code>clang</code>.</p></div></div></section>
</li>
<li><section class="engine"><a href="https://mobirise.info/l">free web templates</a></section><section class="header9 cid-c2081" id="header9-h"> <div class="container"><div class="media-container-column mbr-white"><p class="mbr-text align-left pb-3 mbr-fonts-style display-7" style="background-color:#ffffff">The <tt>--AddOpaqueKinds=question</tt> adds the code in outlined functions, for reasons I really
       can't remember at the moment. It should probably be fixed, but in the mean time you can just
       inline the calls:</p></div></div></section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">      --Transform=AddOpaque \
         --Functions=... \
         --AddOpaqueKinds=question \
      --Transform=Inline \
         --Functions=/.*QUESTION.*/ \
</code></pre>
</center>
</li>
</ul>
</div></div></div></section>


  <script src="assets/popper/popper.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script async src="assets/tether/tether.min.js"></script>
  <script async src="assets/dropdown/js/nav-dropdown.js"></script>
  <script async src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script async src="assets/touchswipe/jquery.touch-swipe.min.js"></script>
  <script async src="assets/viewportchecker/jquery.viewportchecker.js"></script>
  <script async src="assets/smoothscroll/smooth-scroll.js"></script>
  <script async src="assets/theme/js/script.js"></script>
  
  
  <input name="animation" type="hidden">
  
</body>
</html>
