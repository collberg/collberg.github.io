
<!DOCTYPE html>
<html  >
<head>
  
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/tigress-white-128x101.png" type="image/x-icon">
  <meta name="description" content="Web Maker Description">
  
   <link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/popup-overlay-plugin/style.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/socicon/css/styles.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600,700,800,900,300i,400i,500i,600i,700i,800i,900i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600,700,800,900,300i,400i,500i,600i,700i,800i,900i&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  <link rel="preload" as="style" href="assets/mobirise/css/tigress.css">       <link rel="stylesheet" href="assets/mobirise/css/tigress.css"        type="text/css">
  
  
 <style>
body {
  background-color: #ffffff;
  color: #000000
}
section {
  background-color: #ffffff;
  color: #000000
}
p {
   color: #000000
}
h3 {
   color: #000000
}
code {
  font-family:     "Courier New"
                    Courier
                    monospace;
  color: black;
}

</style>
  
</head>
<body>
  
  <section class="menu cid-um5eFJALJY" once="menu" id="menu1-16">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html">
                         <img src="assets/images/screenshot-2024-08-20-at-14.25.07-copy-126x121.png" alt="" title="" style="height: 4.1rem;">
                    </a>
                </span>
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-4" href="index.html">
                        Tigress</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true"><li class="nav-item dropdown">
                    <a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Usage</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="quickstart.html">Quickstart<br></a><a class="text-white dropdown-item text-primary display-4" href="mergeFiles.html">File merge<br></a><a class="text-white dropdown-item text-primary display-4" href="crossCompile.html">Cross compile</a><a class="text-white dropdown-item text-primary display-4" href="recipes.html">Recipes</a><a class="text-white dropdown-item text-primary display-4" href="libraries.html">Libraries</a><a class="text-white dropdown-item text-primary display-4" href="top-level.html">Top-Level Options</a><a class="text-white dropdown-item text-primary display-4" href="bugs.html">Issues</a><a class="text-white dropdown-item text-primary display-4" href="tigress-test.html">Testing</a></div>
                </li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Platforms</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="linux.html">Linux<br></a><a class="text-white dropdown-item text-primary display-4" href="macos.html">MaxOS<br></a><a class="text-white dropdown-item text-primary display-4" href="windows.html">Windows<br></a><a class="text-white dropdown-item text-primary display-4" href="android.html">Android<br></a><a class="text-white dropdown-item text-primary display-4" href="wasm.html">WASM<br></a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Users</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="academics.html">For academics<br></a><a class="text-white dropdown-item text-primary display-4" href="students.html">For students<br></a><a class="text-white dropdown-item text-primary display-4" href="practitioners.html">For practitioners<br></a><a class="text-white dropdown-item text-primary display-4" href="developers.html">For developers<br></a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" aria-expanded="false" data-toggle="dropdown-submenu">News</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="news.html" aria-expanded="false">News</a><a class="text-white dropdown-item text-primary display-4" href="blog.html" aria-expanded="false">Blog</a><a class="text-white dropdown-item text-primary display-4" href="update3to4.html" aria-expanded="false">Updates v3 âžž v4</a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">Transformations</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="control.html">Control</a><a class="text-white dropdown-item text-primary display-4" href="data.html">Data</a><a class="text-white dropdown-item text-primary display-4" href="functions.html">Functions</a><a class="text-white dropdown-item text-primary display-4" href="integrity.html">Integrity</a><a class="text-white dropdown-item text-primary display-4" href="environment.html">Environment</a><a class="text-white dropdown-item text-primary display-4" href="antiAnalysis.html">Anti analysis</a><a class="text-white dropdown-item text-primary display-4" href="other.html">Other</a></div></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" href="#" data-toggle="dropdown-submenu" aria-expanded="false">About</a><div class="dropdown-menu"><a class="text-white dropdown-item text-primary display-4" href="about.html">History<br></a><a class="text-white dropdown-item text-primary display-4" href="FAQ.html">FAQ<br></a><a class="text-white dropdown-item text-primary display-4" href="consulting.html">Training<br></a><a class="text-white dropdown-item text-primary display-4" href="publications.html">Pubs</a></div></li><li class="nav-item"><a class="nav-link link text-white text-primary display-4" href="contact.html" aria-expanded="false"><span class="socicon socicon-mail mbr-iconfont mbr-iconfont-btn"></span></a></li><li class="nav-item"><a class="nav-link link text-white text-primary display-4" href="download4.html" aria-expanded="false"><span class="mbrib-download mbr-iconfont mbr-iconfont-btn"></span></a></li></ul>
            
        </div>
    </nav>
</section>

<br><br><br><br>

<section class="mbr-section content4 TIGRESS-TITLE" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Virtualize

               </h2>
            </div>
        </div>
    </div>
</section>

<center><img width="500px" src="tigress3-images/virtualize-front-page.png"></center>


<a class="anchor" id="virtualize">&nbsp;</a>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
   This transformation turns a function into an interpreter, whose
   bytecode language is specialized for this function. The
   transformation has been designed to induce as much diversity as
   possible, i.e. every decision made is dependent on the
   randomization seed. The diversity is both static and dynamic, i.e. each
   interpreter variant differs in the structure of its code as well as
   in its execution pattern.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
A generated interpreter consists of a virtual instruction set, 
specialized for the input function, a bytecode array, a virtual
program counter (VPC), a virtual stack pointer (VSP), a dispatch
unit, and a list of instruction handlers, one for each virtual
instruction. 

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Here is a <a href="https://ligerlabs.org">LigerLabs</a> video that gives a
good introduction to the virtualization obfuscation:

            </p>
        </div>
    </div>
</section>

<center>
   <video preload="none"
         controls
         poster="https://arizona.box.com/shared/static/ltbhj8tqkmm83mi0xnu3y1sd43oj444r.png" 
         width="500"
    >
    <source src="https://arizona.box.com/shared/static/sctfxzjnzxpkh5lxzja1tvyraa3biqxz.m4v"
                 type="video/mp4">
   </video>
</center>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
 Here's an example of an interpreter constructed by Tigress for the program
<code>main(){int x; x++;}</code>:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">enum ops {Locals = 116, Plus  = 135, Load   = 60, Goto = 231,
          Const  = 3,   Store = 122, Return = 72};

unsigned char bytecode[41]  = {
 Locals,24,0,0,0,Const,1,0,0,0,Locals,24,0,0,0,Load,Plus,Store,Locals,
 28,0,0,0,Const,0,0,0,0,Store,Goto,4,0,0,0,Locals,28,0,0,0,Load,Return};

int main() { 
  while (1) {
    switch (*pc) {
    case Const: pc++; (sp+1)->_int = *((int *)pc); sp++; pc+=4; break;
    case Load: pc++; sp->_int = *((int *)sp->_vs); break;
    case Goto: pc++; pc+= *((int *)pc); break;
    case Plus: pc++; (sp+-1)->_int=sp->_int+(sp+-1)->_int; sp--; break;
    case Return: pc++; return (sp->_int); break;
    case Store: pc++; *((int *)(sp+-1)->_vs)=sp->_int; sp+=-2; break;
    case Locals: pc++; (sp+1)->_vs=(void *)(vars+*((int *)pc)); 
                 sp++; pc+=4; break;
}}
</code></pre>
</center>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
For this transformation, Tigress first constructs type-annotated
abstract syntax tree (AST) from the C source, from which it generates
control-flow graphs of instruction trees. Tigress then selects a random
instruction set architecture (ISA) and, using this ISA, generates a
bytecode program specialized for the input function. Finally, Tigress
selects a random dispatch method and produces an output program.

            </p>
        </div>
    </div>
</section>

<a class="anchor" id="diversity">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Diversity and Stealth

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
<strong>Static diversity.</strong> Tigress supports two mechanisms for generating 
ISAs with a high degree of static diversity:

            </p>
        </div>
    </div>
</section>

<section class="mbr-section article content12 TIGRESS-UL" id="content12-dv">
    <div class="container">
        <div class="media-container-row">
            <div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
                <ul>

<li>
          instruction opcodes can be randomized,

</li>

<li>
          the ISA can have duplicate instructions with the same semantics, 

</li>

<li>
          instructions can pass arguments in arbitrary combinations of stack locations and registers, 

</li>

<li>
          instructions can be made arbitrarily long (with highly complex semantics) through the use of superoperators. 

</li>

                </ul>
            </div>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
<strong>Dynamic diversity.</strong> We ensure that dynamic execution patterns are 
diversified by merging randomized bogus functions with the ``real'' 
function. We can furthermore impede dynamic analysis by making instruction
traces artificially long.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
<strong>Static stealth.</strong>
Not only diversity but also <em>stealth</em> is important for
interpreters. For static stealth, the <code>split</code> transformation can break up the
interpreter loop into smaller pieces, and the <code>AddOpaque</code>
transformation can make instruction handlers less conspicuous.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
<strong>Dynamic stealth.</strong>  For dynamic stealth, Tigress interpreters can
be made <em>reentrant</em>, meaning only a few iterations of the
dispatch loop are executed at a time, effectively mixing instructions
executed from the interpreter with instructions executed by the rest
of the program. This is of particular interest when wanting to hide
the execution pattern from analysts, and when the exact time that the
function executes is not important, as long as it completes <em>eventually</em>.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Here is a <a href="https://ligerlabs.org">LigerLabs</a> video that presents some of
protections against attack that can be added to an obfuscated interpreter:

            </p>
        </div>
    </div>
</section>

<center>
   <video preload="none"
         controls
         poster="https://arizona.box.com/shared/static/ltbhj8tqkmm83mi0xnu3y1sd43oj444r.png" 
         width="500"
    >
    <source src="https://arizona.box.com/shared/static/vsdzmgxrat5g1f64cs8r5ogxigf5bo7l.m4v"
                 type="video/mp4">
   </video>
</center>


<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Usage

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
A typical call to Tigress to virtualize a function <code>foo</code> looks like this:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">tigress \
   --Environment=x86_64:Linux:Gcc:4.6 \
   --Transform=Virtualize \
      --Functions=foo \
      --VirtualizeDispatch=direct \
   --out=out.c in.c
</code></pre>
</center>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
And here are the options for debugging and optimization:

            </p>
        </div>
    </div>
</section>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--Transform</tt></td>
<td><tt>Virtualize</tt></td>
<td> Turn a function into an interpreter. </td>
</tr>
<tr>
<td><tt>--VirtualizeShortIdents</tt></td>
<td><tt>bool</tt></td>
<td> Generate shorter identifiers to produce interpreters suitable for publication. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizePerformance</tt></td>
<td><tt>IndexedStack, PointerStack, AddressSizeShort, AddressSizeInt, AddressSizeLong, CacheTop</tt></td>
<td> Tweak performance. A comma-separated list of the options below. MODIFIES Virtualize DEFAULT PointerStack 
<ul>
   <li> <tt>IndexedStack</tt> = Use array indexing to access stack elements.
   <li> <tt>PointerStack</tt> = Use pointer operations to access stack elements.
   <li> <tt>AddressSizeShort</tt> = Assume addresses for accessing instruction handlers fit in a short (only available with direct dispatch).
   <li> <tt>AddressSizeInt</tt> = Assume addresses for accessing instruction handlers fit in an int (only available with direct dispatch).
   <li> <tt>AddressSizeLong</tt> = Assume addresses for accessing instruction handlers fit in a long (only available with direct dispatch).
   <li> <tt>CacheTop</tt> = Store the top of stack in a register.
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeOptimizeBody</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Clean up after superoperator generation by optimizing the body of the generated function. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeOptimizeTreeCode</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Do constant folding etc. prior to interpreter generation. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeTrace</tt></td>
<td><tt>instr, args, stack, checkTags, actions, regs, locals, checkLocals, threads, *</tt></td>
<td> Insert tracing code to show the stack and the virtual instructions executing. Default=print nothing.
<ul>
   <li> <tt>instr</tt> = print instruction names
   <li> <tt>args</tt> = print arguments to instructions
   <li> <tt>stack</tt> = print stack contents. Currently only works if you set <tt>--VirtualizePerformance=IndexedStack</tt>. You get more readable output if you <tt>--VirtualizeTaggedStore=true</tt>
   <li> <tt>checkTags</tt> = check that the tags indicate the correct type. Requires <tt>--VirtualizeTaggedStore=true</tt> to be set.
   <li> <tt>actions</tt> = print high level actions as they occur
   <li> <tt>regs</tt> = print register contents (not implemented)
   <li> <tt>locals</tt> = print current values of local variables
   <li> <tt>checkLocals</tt> = print local variables that have changed after a store. Useful to find stores that affect more than one variable, ie. write overruns.
   <li> <tt>threads</tt> = trace the thread execution for <tt>--VirtualDispatch=concurrent</tt>.
   <li> <tt>*</tt> = select all options
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeTaggedStore</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Make stack and registers tagged with their type. Useful for debugging. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeStackSize</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Number of elements in the evaluation stack. Default=32.</td>
</tr>
<tr>
<td><tt>--VirtualizeComment</tt></td>
<td><tt>bool</tt></td>
<td> Insert comments in the generated interpreter. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeDump</tt></td>
<td><tt>input, tree, ISA, instrs, types, vars, strings, SuperOps, calls, bytes, array, stack, *</tt></td>
<td> Dump internal data structures used by the virtualizer. Comma-separated list. Default=dump nothing.
<ul>
   <li> <tt>input</tt> = dump the function that is to be virtualized
   <li> <tt>tree</tt> = dump the expression trees generated from the CIL representation
   <li> <tt>ISA</tt> = dump the Instruction Set Architecture
   <li> <tt>instrs</tt> = dump the generated virtual instructions
   <li> <tt>types</tt> = dump the types found
   <li> <tt>vars</tt> = dump the local variables found
   <li> <tt>strings</tt> = dump the strings found
   <li> <tt>SuperOps</tt> = dump the super operator instructions
   <li> <tt>calls</tt> = dump the function calls found
   <li> <tt>bytes</tt> = dump the bytecode array
   <li> <tt>array</tt> = dump the instruction array
   <li> <tt>stack</tt> = dump the evaluation stack
   <li> <tt>*</tt> = select all options
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeConditionalKinds</tt></td>
<td><tt>branch, compute, flag</tt></td>
<td> Ways to transform the one conditional branch that occurs in instruction handlers. Default=branch.
<ul>
   <li> <tt>branch</tt> = Use normal branches, such as <tt>if (a>b) VPC=L1 else VPC=L2</tt>
   <li> <tt>compute</tt> = Compute the branch, such as <tt>x=(a>b); VPC=*(<em>expression over <tt>x</tt></em>)</tt>. Not yet implemented.
   <li> <tt>flag</tt> = Compute the branch from the values of the flag register, such as <tt>asm("cmp a b;pushf;pop"); VPC=*(<em>expression over <tt>flag register</tt></em>)</tt>
</ul>
</td>
</tr>
</table>
</div>

</center>
</br>

<a class="anchor" id="dispatch">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Dispatch Method Selection

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
For both static and dynamic diversity, Tigress supports nine different
dispatch methods. The following code is generated for the different methods,
   where &Xi;<sup><code>op1</code></sup>; is the instruction handler for
   operator <code>op1</code>:

            </p>
        </div>
    </div>
</section>

<center>
<table align=center  class="smalltab">
   <tr><th>Dispatch</th><th>Generated code</th></tr>

   <tr>
   <td><code>switch</code></td>
   <td>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">switch(prog[pc]) {
   op1: &Xi;<sup><code>op1</code></sup>; break;
   op2: &Xi;<sup><code>op2</code></sup>; break;
}
</code></pre>
   </td>
   </tr>

   <tr>
   <td><code>direct</code></td>
   <td>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">goto *prog[pc];
op1hdl: &Xi;<sup><code>op1</code></sup>; goto *prog[pc];
op2hdl: &Xi;<sup><code>op2</code></sup>; goto *prog[pc];
</code></pre>
   </td>
   </tr>

   <tr>
   <td><code>indirect</code></td>
   <td>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">goto *jtab[prog[pc]];
op1hdl: &Xi;<sup><code>op1</code></sup>; goto *jtab[prog[pc]];
op2hdl: &Xi;<sup><code>op2</code></sup>; goto *jtab[prog[pc]];
</code></pre>
   </td>
   </tr>

   <tr>
   <td><code>call</code></td>
   <td>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">void op1fun(){&Xi;<sup><code>op1</code></sup>}
void op2fun(){&Xi;<sup><code>op2</code></sup>}
&hellip;
call *prog[pc]();
</code></pre>
   </td>

   <tr>
   <td><code>ifnest</code></td>
   <td>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">if (prog[pc]==op1) &Xi;<sup><code>op1</code></sup>
else if (prog[pc]==op2) &Xi;<sup><code>op2</code></sup>
else if &hellip;
</code></pre>
   </td>

   <tr>
   <td><code>linear, binary, interpolation</code></td>
   <td>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">alg = linear|binary|interpolation|&hellip;
top: 
   goto *(<b>search</b><sup>alg</sup>(map,prog[pc]));
op1hdl: &Xi;<sup><code>op1</code></sup>; goto top;
op2hdl: &Xi;<sup><code>op2</code></sup>; goto top;
</code></pre>
   </td>
   </tr>
</center>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Tigress also supports concurrent dispatch, which is a variant of <tt>switch</tt> dispatch, where every iteration around the interpreter loop is split between a number of concurrently executing threads. It's specified like this: <tt>--VirtualizeDispatch=concurrent --VirtualizeNumberOfThreads=2</tt>.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
To further confuse static analysis, in an direct and indirect threaded dispatch loop you can make every indirect jump go through a branch function. It is specified like this: 

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">--Transform=InitBranchFuns \
   --InitBranchFunsCount=1 \
    ...  \
--Transform-Virtualize \
   --VirtualizeDispatch=direct \
   --VirtualizeBranchFunctions=true
</code></pre>
</center>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeDispatch</tt></td>
<td><tt>switch, direct, indirect, call, ifnest, linear, binary, interpolation, concurrent, ?, *</tt></td>
<td> Select the interpreter's dispatch method. The argument should be a comma-separated list of disparch kinds. One of these will be picked at random. Default=switch.
<ul>
   <li> <tt>switch</tt> = dispatch by while(){switch(next){...}}
   <li> <tt>direct</tt> = dispatch by direct threading
   <li> <tt>indirect</tt> = dispatch by indirect threading
   <li> <tt>call</tt> = dispatch by call threading
   <li> <tt>ifnest</tt> = dispatch by nested if-statements
   <li> <tt>linear</tt> = dispatch by searching a table using linear search
   <li> <tt>binary</tt> = dispatch by searching a table using binary search
   <li> <tt>interpolation</tt> = dispatch by searching a table using interpolation search
   <li> <tt>concurrent</tt> = dispatch by spawning threads
   <li> <tt>?</tt> = pick a random dispatch method
   <li> <tt>*</tt> = select all dispatch method
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeNumberOfThreads</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Number of threads to spawn when using <tt>concurrent</tt> dispatch. Default=2.</td>
</tr>
<tr>
<td><tt>--VirtualizeBranchFunctions</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Make every dispatch jump go through a branch function. This only applies to  direct and indirect threaded dispatch. Requires <tt>--Transform=InitBranchFuns --InitBranchFunsCount=1</tt>. Default=false.</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="ISA">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Instruction Set Architecture Generation

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Instruction sets can use stacks, registers, or both to pass values
between instructions. By default, the following, very simple, instruction
set is used:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">  labels:         l &isin; <it>Labels</code> 
  functions:      f &isin; <it>Funs</it> 
  variables:      x &isin; <it>Vars</it> 
  strings:        s &isin; <it>Strings</it> 
  temporaries:     t ::= <code>reg</code><sup><it>int</it></sup> | <code>stack</code><sup><it>int</it></supt>  
  binary operators: <it>binop</it> ::= <code>add</code> | <code>sub</code> | &hellip;
  unary operators:  <it>unop</it> ::= <code>uminus</code> | <code>neg</code> | &hellip;
  types:           &tau; ::= <code>int</code> | <code>float</code> | &hellip; | <code>void *</code>
  literals:        &lambda; ::= <code>intlit</code> | <code>floatlit</code> | &hellip;
  instructions: e ::=  
       t &larr; <code>constant</code> &tau; &lambda;
     | t &larr; <code>local</code>  x
     | t &larr; <code>global</code>  x
     | t &larr; <code>formal</code>  x
     | t &larr; <code>string</code>  s
     | t &larr; <code>binary</code>  &tau;  <it>binop</it> t t
     | t &larr; <code>unary</code>  &tau;  <it>unop</it> t
     | t &larr; <code>convert</code>  &tau; &tau; t
     | t &larr; <code>ternary</code>  &tau; t t t
     | t &larr; <code>load</code>  &tau; t
     | <code>store</code> &tau; t t
     | t &larr; <code>memcpy</code>  t t <it>int</it>
     | <code>call</code>  f
     | x, x, &larr; <code>asm</code>  s  t, t, &hellip;
     | <code>indirectCall</code>  t
     | <code>return</code>  &tau; t
     | <code>goto</code>  l
     | t &larr; <code>addrOfLabel</code>  l
     | <code>indirectGoto</code>  t
     | <code>branchIfTrue</code>  t  l 
     | <code>switch</code>  &tau; t  &lambda;  &lambda;  l &lang;l, l, &hellip;&rang; 
     | <code>merged</code>  &lang; e, e, \ldots&rang; 
</code></pre>
</center>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
However, a high degree of diversity can be achieved from the way
instructions communicate with each other, through values stored on the
stack or passed in virtual registers.  Tigress can generate
instructions that use any combination of registers and stack storage
for the inputs they read or the output they produce. 

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Tigress can induce further diversity by merging
instructions into <em>superoperators</em>. New, merged, instructions
can have an almost abritrary complex semantics, involving multiple arithmetic 
operations and operations both on the stack and virtual registers.
For more information on superoperators, see
<a href="http://dl.acm.org/citation.cfm?id=199526">Optimizing an ANSI
C interpreter with superoperators</a>
by <a href="http://proebsting.cs.arizona.edu">Todd Proebsting</a>.
The complex semantics of instructions generated by superoperators make
manual analysis of generated interpreters, such as discussed by Rolles
in <a href="http://dl.acm.org/citation.cfm?id=1855877">Unpacking
virtualization obfuscators</a>, difficult.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Consider setting <code>--VirtualizeMaxDuplicateOps=2</code> 
and <code>--VirtualizeOperands=mixed</code> resulting in two <em>store-int</em>
instructions, one that takes both arguments in registers, and one that takes
one argument on the stack and the other in a register. Tigress will chose 
between them randomly. Here are the corresponding instruction handlers:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">case _0__store_int$left_REG_0$right_REG_1: 
   (_0__pc[0]) ++;
   *((int *)_0__regs[0][*((int *)_0__pc[0])]._void_star) = _0__regs[0][*((int *)(_0__pc[0] + 4))]._int;
   _0__pc[0] += 8;
   break;

case _0__store_int$right_STA_0$left_REG_0: 
   (_0__pc[0]) ++;
   *((int *)_0__regs[0][*((int *)_0__pc[0])]._void_star) = _0__stack[0][_0__sp[0] + 0]._int;
   (_0__sp[0]) --;
   _0__pc[0] += 4;
   break;
</code></pre>
</center>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Consider next setting <code>--VirtualizeSuperOpsRatio=2.0</code> and <code>--VirtualizeMaxMergeLength=10</code>,
resulting in virtual instructions with highly complex semantics:

Here is the instruction handler for one such instruction, made up by merging 10 primitive instructions:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">case _0__local$result_STA_0$value_LIT_0__\
   convert_void_star2void_star$left_STA_0$result_REG_0__\
   load_int$result_REG_0$left_REG_1__\
   local$result_STA_0$value_LIT_0__\
   convert_void_star2void_star$left_STA_0$result_REG_0__\
   store_int$left_REG_0$right_REG_1__\
   local$result_REG_0$value_LIT_1__\
   local$result_STA_0$value_LIT_0__\
   convert_void_star2void_star$left_STA_0$result_REG_0__\
   load_int$result_STA_0$left_REG_0: 
    (_0__pc[0]) ++;
    _0__regs[0][*((int *)(_0__pc[0] + 4))]._void_star = (void *)(_0__locals + *((int *)_0__pc[0]));
    _0__regs[0][*((int *)(_0__pc[0] + 8))]._int = *((int *)_0__regs[0][*((int *)(_0__pc[0] + 12))]._void_star);
    _0__regs[0][*((int *)(_0__pc[0] + 20))]._void_star = (void *)(_0__locals + *((int *)(_0__pc[0] + 16)));
    *((int *)_0__regs[0][*((int *)(_0__pc[0] + 24))]._void_star) = _0__regs[0][*((int *)(_0__pc[0] + 28))]._int;
    _0__regs[0][*((int *)(_0__pc[0] + 32))]._void_star = (void *)(_0__locals + *((int *)(_0__pc[0] + 36)));
    _0__regs[0][*((int *)(_0__pc[0] + 44))]._void_star = (void *)(_0__locals + *((int *)(_0__pc[0] + 40)));
    _0__stack[0][_0__sp[0] + 1]._int = *((int *)_0__regs[0][*((int *)(_0__pc[0] + 48))]._void_star);
    (_0__sp[0]) ++;
    _0__pc[0] += 52;
    break;
</code></pre>
</center>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Note that the instruction name really is almost 400 characters long; the
backslashes are here only for display purposes! Also note that the instruction
itself is 53 bytes long, almost as long as the 
<a href="https://groups.google.com/forum/#!topic/comp.arch/OJYBg8o7vcQ">longest VAX instruction</a>
(<code>EMODH</code>, 54 bytes) and much longer than the longest x86 instruction 
(15 bytes) 

            </p>
        </div>
    </div>
</section>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeOperands</tt></td>
<td><tt>stack, registers, mixed, ?</tt></td>
<td> Comma-separated list of the types of operands allowed in the ISA. Default=stack.
<ul>
   <li> <tt>stack</tt> = use stack arguments to instructions
   <li> <tt>registers</tt> = use register arguments to instructions
   <li> <tt>mixed</tt> = same as stack,registers
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeMaxDuplicateOps</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Number of ADD instructions, for example, with different signatures. Default=0.</td>
</tr>
<tr>
<td><tt>--VirtualizeRandomOps</tt></td>
<td><tt>bool</tt></td>
<td> Should opcodes be randomized, or go from 0..n? Default=true.</td>
</tr>
<tr>
<td><tt>--VirtualizeSuperOpsRatio</tt></td>
<td><tt>Float>0.0</tt></td>
<td> Desired number of super operators. Default=0.0.</td>
</tr>
<tr>
<td><tt>--VirtualizeMaxMergeLength</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Longest sequence of instructions to be merged into one. Default=0.</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="HandlerObfuscation">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Instruction Handler Obfuscation

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
You can split up the generated interpreter by inserting opaque predicates. This is useful to 
make the instruction handlers and the dispatch logic less conspicuous. Here's one example; the 
handler can obviously be split in multiple ways: 

            </p>
        </div>
    </div>
</section>

<center><img width="500px" src="tigress3-images/split-handlers.png"></center>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeInstructionHandlerSplitCount</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Number of opaques to add to each instruction handler. Default=0.</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="VPCObfuscation">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 VPC Obfuscation

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
You can add opaque expressions to the virtual PC to make it 
more difficult to find.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
One possible attack on interpreters is to perform a taint analysis
on input-dependent variables and discard any instructions which are
not tainted. To frustrate such analyses we can add implicit flow to the VPC.

            </p>
        </div>
    </div>
</section>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeAddOpaqueToVPC</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Whether to add opaques to the virtual program counter. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeImplicitFlowPC</tt></td>
<td><tt>PCInit, PCUpdate, *</tt></td>
<td> Insert implicit flow between the virtual program counter and instruction dispatcher. Default=none.
<ul>
   <li> <tt>PCInit</tt> = insert implcit flow between the computation of the VPC address and the first load
   <li> <tt>PCUpdate</tt> = insert implcit flow for each VPC load (potentially very slow)
   <li> <tt>*</tt> = select all options
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeImplicitFlow</tt></td>
<td><tt>S-Expression</tt></td>
<td> The type of implicit flow to insert. See <tt>--AntiTaintAnalysisImplicitFlow</tt> for a description. Default=none.</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="BogusFunctions">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Bogus Functions

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Generate bogus functions that are virtualized along with the "real"
function. Instructions from the bogus and real function are executed
cyclically and in sequence, i.e. first an instruction from the real function, then
one from bogus function number 1, then one from bogus function number 2, etc., 
and then the process repeats with an instruction from the real 
function. The purpose is to frustrate dynamic analyses that try to
locate the virtual program counter, by providing multiple VPCs,
one "real", and one or more that behave as if they were real, 
but which interpret unused functions:
<center><img width="500px" src="tigress3-images/bogus-functions-2.png"></center>

            </p>
        </div>
    </div>
</section>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeNumberOfBogusFuns</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Weave the execution of random functions into the execution of the original program. This makes certain kinds of pattern-based dynamic analysis more difficult. Default=0.</td>
</tr>
<tr>
<td><tt>--VirtualizeAddOpaqueToBogusFuns</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Whether to add opaque expressions to the generated bogus function. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeBogusFunsGenerateOutput</tt></td>
<td><tt><em><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></em></tt></td>
<td> Make the bogus function produce output (typically be writing to /dev/null), to prevent it from appearing to have no effect. Default=true.</td>
</tr>
<tr>
<td><tt>--VirtualizeBogusFunKinds</tt></td>
<td><tt>trivial, arithSeq, collatz, *</tt></td>
<td> The kind of bogus function to generate. Comma-separated list. Default=arithSeq,collatz.
<ul>
   <li> <tt>trivial</tt> = insert a trivial computation
   <li> <tt>arithSeq</tt> = insert a simple arithmetic loop
   <li> <tt>collatz</tt> = insert a computation of the Collatz sequence
   <li> <tt>*</tt> = select all options
</ul>
</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="BogusLoops">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Bogus Loops

               </h2>
            </div>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Add random computations to every iteration of the dispatch loop.  
Use this to frustrate dynamic analysis by

            </p>
        </div>
    </div>
</section>

<section class="step1 TIGRESS-OL" id="step1-dy">
    <div class="container">
        <div class="step-container">


            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            1
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
      inserting bogus instructions between consecutive iterations of the dispatch loop, 
          thereby making the dispatch harder to recognize;

                        </p>
                    </div>
                </div>
            </div>

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            2
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
         making traces longer and thereby harder to store and analyze.

                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
<br>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeBogusLoopKinds</tt></td>
<td><tt>trivial, arithSeq, collatz, *</tt></td>
<td> Insert a bogus loop for each instruction list. This will extend the length of the trace, making dynamic analysis more difficult. Default=collatz.
<ul>
   <li> <tt>trivial</tt> = insert a trivial computation
   <li> <tt>arithSeq</tt> = insert a simple arithmetic loop
   <li> <tt>collatz</tt> = insert a computation of the Collatz sequence
   <li> <tt>*</tt> = select all options
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeBogusLoopIterations</tt></td>
<td><tt><em><a href="top-level.html#INTSPEC">INTSPEC</a></em></tt></td>
<td> Adjust this value to balance performance and trace length. Default=0.</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="Reentrant">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Reentrant Interpreters

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Make interpreters that can execute a few instructions,
return, and later resume to execute a few more instructions,
until, eventually, they terminate. This is particularly
useful when it is not important exactly when
the a piece of code executes, as long as it executes <em>eventually</em>,
and where the stealthiness of the computations is paramount.

            </p>
        </div>
    </div>
</section>



<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
You must prepare your code in the following ways:

            </p>
        </div>
    </div>
</section>

<section class="step1 TIGRESS-OL" id="step1-dy">
    <div class="container">
        <div class="step-container">


            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            1
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        The function you want to virtualize must have an argument
        <code>int* operation</code>. It can occur anywhere among the formal parameters:
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">void foo(int* operation, int n, int* result) {&hellip;}
</code></pre>

                        </p>
                    </div>
                </div>
            </div>
<!-- --------------------------- -->

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            2
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        The first time foo gets called, operation must be
        <0, and you must pass actual arguments to foo that
        it will use throughout the computation:
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">int operation = -10; 
foo(&operation,n,&result);
</code></pre>
       <br> 
       "-10" here means to initialize foo and execute 10
        instructions.

                        </p>
                    </div>
                </div>
            </div>
<!-- --------------------------- -->

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            3
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
          Sprinkle calls to foo throughout your program,
         making sure that operation>0:
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">operation = 10;
foo(&operation,bogus1,&bogus2);  
</code></pre>
         <br>
         Here you can pass whatever arguments you want to foo, 
         they won't be used. Rather, the ones that were passed 
         in the first call will be used throughout. "10" here 
         means to resume foo and execute 10 instructions.

                        </p>
                    </div>
                </div>
            </div>
<!-- --------------------------- -->

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            4
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        You can check if foo has terminated by testing the
        value of operation after the call:
        <br>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">operation = 10;
foo(&operation,bogus1,&bogus2);  
if (operation > 0)
   /* we're done! */
else if (operation < 0)
   /* more work to do! */
</code></pre>

                        </p>
                    </div>
                </div>
            </div>
<!-- --------------------------- -->

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            5
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        If you want to make sure that foo has terminated
        --- because you really want its result at a particular
          point --- set operation to a large enough value:
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">operation = 1000;
foo(&operation,bogus1,&bogus2);  
</code></pre>

                        </p>
                    </div>
                </div>
            </div>
<!-- --------------------------- -->

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            6
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        Additional calls to foo once termination has been
        reached is safe; no additional instructions will
        be executed.

                        </p>
                    </div>
                </div>
            </div>
<!-- --------------------------- -->

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            7
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        If you want to call foo to compute a new value, 
        call it again with operation<0:
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">   int operation = -10; 
   foo(&operation,n,&result);
</code></pre>

                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
To ensure termination you can

            </p>
        </div>
    </div>
</section>

<section class="step1 TIGRESS-OL" id="step1-dy">
    <div class="container">
        <div class="step-container">


            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            1
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        experiment yourself with how many iterations
        are necessary to finish the computation;

                        </p>
                    </div>
                </div>
            </div>

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            2
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        make sure that the last call to foo is passed a
            huge value to 'operation';

                        </p>
                    </div>
                </div>
            </div>

            <div class="card separline pb-4">
                <div class="step-element d-flex">
                    <div class="step-wrapper pr-3">
                        <h3 class="step d-flex align-items-center justify-content-center">
                            3
                        </h3>
                    </div>          
                    <div class="step-text-content">
                        <p class="mbr-step-text mbr-fonts-style display-7">
        put the last call to foo in a loop 
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">   foo(&operation);   
   while (operation < 0) {
      /* some other computation here */
      operation = 10;
      foo(&operation);   
   } 
   /* result is available here */
</code></pre>

                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
It is a good idea to combine reentrant interpreters with
superoperators. Superoperators produce long instructions
that perform more work during each iteration, and as a
result the number of dispatches (i.e. loop iterations)
is reduced. In other words, if you want to frustrate
dynamic analysis that looks for evidence of the dispatch
loop in the instruction trace, superoperators combined
with reentrant interpreters will reduce the presence of 
such artifacts.

            </p>
        </div>
    </div>
</section>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeReentrant</tt></td>
<td><tt></tt></td>
<td> Make the function reentrant. Default=false.</td>
</tr>
</table>
</div>

</center>
</br>

<a class="anchor" id="EncodingProgram">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Encoding the Program Array

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Setting
<code>--VirtualizeEncodeByteArray=allAtOnce</code>
results in each program instruction being xor:ed with
a constant value, thus ensuring that it is
not in cleartext until it is run. The generated code 
looks something like this:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">unsigned char _5_obf3_$array[1][141]  = 
     {{
        (unsigned char)formal$result_STA_0$value_LIT_0 ^ (unsigned char)16,
        (unsigned char)1 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        (unsigned char)load_int$left_STA_0$result_STA_0 ^ (unsigned char)16,
        (unsigned char)formal$result_STA_0$value_LIT_0 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        (unsigned char)0 ^ (unsigned char)16,
        ...
     }}
</code></pre>
</center>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
This does not work for <code>--VirtualizeDispatch=direct</code>.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Additionally, setting <code>--VirtualizeObfuscateDecodeByteArray=true</code> and
<code>--VirtualizeOpaqueStructs=input,env</code> ensures that the decoded 
bytecode array depends on input. The decoding procedure looks like this:
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">  strcmp_result17 = (int)strlen(*(argv + (argc - 1)));
  decodeVar16 = (strcmp_result17 - 1 < 0) + (strcmp_result17 - 10 > 0) ? currentOp : (unsigned char)16;
  copyIndex15 = 0;
  while (copyIndex15 < 141) {
    localArrayCopy11[0][copyIndex15] = array[0][copyIndex15] ^ decodeVar16;
    copyIndex15 ++;
  }
  $pc[0] = localArrayCopy11[0];
</code></pre>

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Here's an example script:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">tigress --Environment=... --Seed=0 \
   --Transform=InitImplicitFlow \
   --Transform=InitEntropy \
   --Transform=InitOpaque --Functions=main --InitOpaqueStructs=input \
   --Transform=UpdateEntropy --Functions=main --UpdateEntropyVar=argv,argc \
   --Inputs="+1:int:42,-1:length:1?10" \
   --Transform=Virtualize --InitOpaqueStructs=input,env \
   --VirtualizeDispatch=interpolation --Functions=obf3 \
   --VirtualizeEncodeByteArray=allAtOnce \
   --VirtualizeObfuscateDecodeByteArray=true \
   --VirtualizeOpaqueStructs=input,env \
      arith.c --out=arith_out.c
</code></pre>
</center>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
<code>--Inputs="+1:int:42,-1:length:1?10"</code> is a specfication of invariants over
the command line. It specifies:

            </p>
        </div>
    </div>
</section>

<section class="mbr-section article content12 TIGRESS-UL" id="content12-dv">
    <div class="container">
        <div class="media-container-row">
            <div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
                <ul>

<li>
          the first argument on the command line should be the integer 42

</li>

<li>
          the last argument should have a length between 1 and 10 

</li>

                </ul>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
<code>--VirtualizeOpaqueStructs=input,env</code> ensures that the 
program array will be encoded based on these command line invariants.
If the program is invoked with a set of command line arguments that
violate the invariants it is likely to crash.

            </p>
        </div>
    </div>
</section>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Starting with version 3.3.3, setting <tt>--VirtualizeEncodeByteArray=incrementally</tt> results in 
the bytecode array being decoded as each entry is encountered. The instruction handler
code now looks like this, where 3472328296227680304UL is the xor encoding constant: 

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">  __4_callInd__constant_unsigned_long$result_STA_0$value_LIT_0: ;
  (__4_callInd_$pc[0]) ++;
  (__4_callInd_$sp[0] + 1)->_unsigned_long = *((unsigned long *)__4_callInd_$pc[0]) ^ 3472328296227680304UL;
  (__4_callInd_$sp[0]) ++;
  __4_callInd_$pc[0] += 8;
</code></pre>
</center>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeOpaqueStructs</tt></td>
<td><tt>list, array, input, env, *</tt></td>
<td> Default=list,array.
<ul>
   <li> <tt>list</tt> = Generate opaque expressions using linked lists
   <li> <tt>array</tt> = Generate opaque expressions using arrays
   <li> <tt>input</tt> = Generate opaque expressions that depend on input. Requires <tt>--Inputs</tt> to set invariants over input.
   <li> <tt>env</tt> = Generate opaque expressions from entropy. Requires <tt>--InitEntropy</tt>.
   <li> <tt>*</tt> = Same as list,array,input,env
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeEncodeByteArray</tt></td>
<td><tt>allAtOnce, incrementally</tt></td>
<td> Encode the bytecode array. Doesn't work for <tt>direct</tt> dispatch. Requires opaque expressions. Prior to version 3.3.3 this used to be a boolean, which triggered <tt>allAtOnce</tt>. Default=NONE.
<ul>
   <li> <tt>allAtOnce</tt> = Decode the entire bytecode array on entry to the function.
   <li> <tt>incrementally</tt> = Decode each entry in the bytecode array as they are encountered.
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeObfuscateDecodeByteArray</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Obfuscates the program array decoded with opaque expressions. <tt>--VirtualizeOpaqueStructs=input,env</tt> are the preferable opaque kinds, since it means that the bytecode array depends on input. Default=false.</td>
</tr>
</table>
</div>

</center>
</br>

<a class="anchor" id="DynamicProgram">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Dynamic Program Arrays

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Setting <code>--VirtualizeDynamicBytecode=true</code>
results in the program array being constantly modified at runtime,
much in the same way that happens to jitted code in the 
<a href="../jitDynamic/index.html">JitDynamic</a> 
transformation. In fact, exactly the same mechanisms are used
for both transformations, and they share all the same options.
Here's an example script:

            </p>
        </div>
    </div>
</section>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">tigress --Seed=0 \
   --Transform=Virtualize \
      --Functions=foo \
      --VirtualizeDispatch=switch \
      --VirtualizeDynamicBytecode=true \
      --VirtualizeDynamicCodecs=xtea \
      --VirtualizeDynamicKeyTypes=data \
      --VirtualizeDynamicBlockFraction=%100 \
      --VirtualizeDynamicReEncode=true \
      --VirtualizeDynamicRandomizeBlocks=false \
      --VirtualizeDynamicDumpCFG=false \
      --VirtualizeDynamicAnnotateTree=false \
      --VirtualizeDynamicDumpTree=false \
      --VirtualizeDynamicDumpIntermediate=false \
      --VirtualizeDynamicTrace=0 \
      --VirtualizeDynamicTraceExec=false \
      --VirtualizeDynamicTraceBlock=false \
      --VirtualizeDynamicCompileCommand="gcc -o %o %i -lm" \
      arith.c --out=arith_out.c
</code></pre>
</center>

<center>
<div style="mbr-text align-left pb-3 mbr-fonts-style display-7">
<table border style="background-color:#f5f5f5;overflow-x:auto;color:black;width:80%;">
    <colgroup>
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 20%;">
       <col span="1" style="width: 60%;">
    </colgroup>
<tr><th>Option</th><th>Arguments</th><th>Description</th></tr>
<tr>
<td><tt>--VirtualizeDynamicBytecode</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Similar to the JitDynamic transform, make the virtualized bytecode self-modifying. Default=hard.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicOptimize</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Clean up the generated code by removing jumps-to-jumps. Default=true.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicTrace</tt></td>
<td><tt><a href="top-level.html#INTSPEC">INTSPEC</a></tt></td>
<td> Insert runtime tracing of instructions. Set to 1 to turn it on. Default=0.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicTraceExec</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Annotate each instruction, showing from where it was generated, and the results of execution. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicDumpTree</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Print the tree representation of the function, prior to generating the jitting code. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicAnnotateTree</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Annotate the generated code with the corresponding intermediate tree code instructions. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicCodecs</tt></td>
<td><tt>none, ident, ident_loop, xor_transfer, xor_byte_loop, xor_word_loop, xor_qword_loop, xor_call, xor_call_trace, xtea, xtea_trace, stolen_byte, stolen_short, stolen_word</tt></td>
<td> How blocks should be encoded/decoded. Default=*.
<ul>
   <li> <tt>none</tt> = No encoding
   <li> <tt>ident</tt> = The identity encoding using a single copy JIT instruction
   <li> <tt>ident_loop</tt> = The identity encoding using a copy loop of primitive JIT instructions
   <li> <tt>xor_transfer</tt> = An xor encoding using a single xor JIT instruction
   <li> <tt>xor_byte_loop</tt> = An xor encoding using a copy loop of byte-size primitive JIT instructions
   <li> <tt>xor_word_loop</tt> = An xor encoding using a copy loop of word-size primitive JIT instructions
   <li> <tt>xor_qword_loop</tt> = An xor encoding using a copy loop of qword-size primitive JIT instructions
   <li> <tt>xor_call</tt> = An xor encoding calling a xor function
   <li> <tt>xor_call_trace</tt> = An xor encoding calling a xor function with tracing turned on (for debugging)
   <li> <tt>xtea</tt> = An xtea encryption
   <li> <tt>xtea_trace</tt> = An xtea encryption with tracing turned on (for debugging)
   <li> <tt>stolen_byte</tt> = A byte-sized stolen bytes encoding
   <li> <tt>stolen_short</tt> = A short-sized stolen bytes encoding
   <li> <tt>stolen_word</tt> = A word-sized stolen bytes encoding
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicKeyTypes</tt></td>
<td><tt>data, code</tt></td>
<td> Where the encoding/decoding key is stored (for xor and xtea encodings) Default=data.
<ul>
   <li> <tt>data</tt> = In the data segment
   <li> <tt>code</tt> = In the code segment (not implemented)
</ul>
</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicBlockFraction</tt></td>
<td><tt><em><a href="top-level.html#FRACSPEC">FRACSPEC</a></em></tt></td>
<td> Fraction of the basic blocks in a function to encode Default=all.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicRandomizeBlocks</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Randomize the order of basic blocks Default=true.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicReEncode</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> If true, blocks will be re-encoded after being executed. If false, blocks will be decoded once, and stay in cleartext. ('False' is not implemented; this option is always set to 'true'.) Default=true.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicDumpCFG</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Print the jitter's Control Flow Graph. This requires graphviz to be installed (the <tt>dot</tt> command is used). A number of pdf files get generated that shows the CFG at various stages of processing: <tt>CFGAfterInsertingAnnotations.pdf</tt>, <tt>CFGAfterSimplifyingJumps.pdf</tt>, <tt>CFGAfterTranslatingAnnotations.pdf</tt>, <tt>CFGBeforeInsertingAnnotations.pdf</tt>, <tt>CFGDumpingFunctionFinal.pdf</tt>, <tt>CFGDumpingFunctionInitial.pdf</tt>, <tt>CFGFixupIndirecJumps.pdf</tt>, <tt>CFGReplaceWithCompiledBlock.pdf</tt>, <tt>CFGSplitOutBranches.pdf</tt>, <tt>CFGSplitOutDataReferences.pdf</tt>, <tt>OriginalCFG.pdf</tt> Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicTraceBlock</tt></td>
<td><tt><a href="top-level.html#BOOLSPEC">BOOLSPEC</a></tt></td>
<td> Print out a message before each block is executed. Default=false.</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicTraceBlock</tt></td>
<td><tt>STRING</tt></td>
<td> Print out a message before each block is executed. (Not currently implemented.) Default="".</td>
</tr>
<tr>
<td><tt>--VirtualizeDynamicCompileCommand</tt></td>
<td><tt>STRING</tt></td>
<td> A string of the form "gcc -std=c99 -o %o %i", where "%i" will be replaced with the name of the input file and "%o" with the name of the output file. For example, if your program uses the math library, you should set <tt>--VirtualizeDynamicCompileCommand="gcc -std=c99 -o %o %i -lm". Default="gcc -std=c99 -o %o %i".</td>
</tr>
</table>
</div>

</center>
</br>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="regions">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Function Regions

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
You can virtualize a piece of a function, rather than the whole thing. Simpy put 
   the name of the region after the function name, like this: 

            </p>
        </div>
    </div>
</section>

<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">tigress ... --Transform=Virtualize  --Functions=fac:region2 ...
</code></pre>
</center>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
The region has to be defined like this in the code: 

            </p>
        </div>
    </div>
</section>

<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">#include "tigress.h"

void fac(int n) {
  int s=1;
  int i;
  for (i=2; i<=n; i++) {
    TIGRESS_REGION(region2,
      s *= i;
    );
  }
  printf("fac(%i)=%i\n",n,s);
}
</code></pre>
</center>


<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Note that the region needs to be ``self-contained,'' i.e. you can't jump into it, or out of it.
   Also, there will be some performance overhead.

            </p>
        </div>
    </div>
</section>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="notes">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Notes

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
As you are reading the code, there are a couple of interesting things to note:

            </p>
        </div>
    </div>
</section>

<section class="mbr-section article content12 TIGRESS-UL" id="content12-dv">
    <div class="container">
        <div class="media-container-row">
            <div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
                <ul>

<li>
        Much of the symbolic information present in the transformed
        source files (such as types, enumerations, and structured
        control flow) that help make the code easy to read and
        understand, disappears once the source has been compiled,
        linked, and stripped.  A successful attack will (at least partially) 
            have to recover this information. 

</li>

<li>
        The code after <em>two</em> levels of virtualization looks very similar to
        the code after <em>one</em> level of virtualization. This is because the
        dispatch loop of the first virtualization gets coded into the bytecode
        program of the second. It's an interesting question to ask to what
            extent this hinders de-virtualization. 

</li>

<li>
        The <code>direct</code> and <code>call</code> dispatch methods result
        in much larger bytecode programs than the other methods. This
        is particularly evident on 64-bit machines where every opcode
        gets encoded in 8 bytes, in contrast with a single byte for
        the other methods. For this reason, if you are contemplating
        using two levels of interpretation, it's a good idea to make
        the second level <em>not</em> use <code>direct</code> or <code>call</code>
        dispatch, to keep the size of the program down. Future versions
        of Tigress will use more compact encodings for these types of
            dispatch. 

</li>

                </ul>
            </div>
        </div>
    </div>
</section>

<!-- -------------------------------------------------------------------------------- -->

<a class="anchor" id="issues">&nbsp;</a>

<section class="mbr-section content4 TIGRESS-SECTION" id="content4-dz">
    <div class="container">
        <div class="media-container-row">
            <div class="title col-12 col-md-8">
                <h2 class="align-center pb-3 mbr-fonts-style display-2">
 Issues

               </h2>
            </div>
        </div>
    </div>
</section>

<section class="header9 TIGRESS-P" id="header9-dw">
    <div class="container">
        <div class="media-container-column mbr-white">
            <p class="mbr-text align-left pb-3 mbr-fonts-style display-7">
Here are some of the known issues with the Virtualize transformation:

            </p>
        </div>
    </div>
</section>

<section class="mbr-section article content12 TIGRESS-UL" id="content12-dv">
    <div class="container">
        <div class="media-container-row">
            <div class="mbr-text counter-container col-12 col-md-8 mbr-fonts-style display-7">
                <ul>

<li>
        Several dispatch methods make use of <code>gcc's</code> and <code>clang</code>
        <em>labels-as-values</em>. For other compilers only
        the <code>switch</code> and <code>ifnest</code> dispatch methods should be
            used.

</li>

<li>
        <code>--VirtualizeEncodeByteArray=true</code> does not work for the <em>direct</em>
            dispatch method. 

</li>

<li>
        Our current implementation of reentrant interpreters doesn't handle function
        results, so make sure your function is void, and returns the result in a global 
            or in a formal parameter.

</li>

<li>
        The <code>--VirtualizeConditionalKinds=flag</code> option seems to have
        multiple issues on MacOS/llvm. Presumably this is due to some compiler 
            problem related to inline assembly.

</li>

<li>
          Consider this example taken from gcc's <code>comp-goto-1.c</code> torture test: 

</li>

<li>
        By default, Virtualize transforms Variable Length Arrays into calls to <code>alloca</code>. Depending on the 
       platform and the size of the arrays, the generated code can crash. If so, try the option
           <code>--TransformVLA=malloc</code> which converts VLAs to calls to <code>malloc/free</code> instead.

</li>
<center>
<pre style="text-align:left;background-color:#f0f0f0;display:inline-block;padding:20px;border:1px solid black;"><code contenteditable spellcheck="false">goto *(base_addr + insn.f1.offset);
</code></pre>
</center>
      This kind of arithmetic on the program counter is going to fail for 
      transformations that completely restructure the code, such as
      virtualization.

                </ul>
            </div>
        </div>
    </div>
</section>


<script src="assets/popper/popper.min.js"></script>
  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/smoothscroll/smooth-scroll.js"></script>
  <script src="assets/dropdown/js/nav-dropdown.js"></script>
  <script src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="assets/touchswipe/jquery.touch-swipe.min.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  
  
</body>
</html>
